---
sidebar_position: 3
---

# Как deffun работает с GraphQL

## Отношения между типами

Так же как в примере
```graphql
type MyUser {
    ...
    followers: [MyUser!]
}
```
пользователь связан с другими пользователями-фалловерами, можно составить отношения и с любым другим типом.
deffun возьмёт на себя создание схемы базы данных по этим отношениям.

Обычно вылеляется 4 вида отношений между типами:
- "Один к одному"
- "Один ко многим"
- "Многие к одному" - то же, что и "Один ко многим", но в обратную сторону.
- "Многие ко многим"

Отношения между типами могут быть однонаправленными или двунаправленными.

В deffun вы можете объявить любое из этих отношений с помощью поля другого типа или списка.

В качестве примера рассмотрим как можно создать схему для своего приложения для HR.

```
type Employee {
    ...
    currentJob: Job
    previousJobs: [Job]
}
type Job {
    ...
    title: String
    at: Company
}
type Company {
    ...
    employees: [Employee]
}
```
`Employee` - работник/соискатель.
`Job` - место работы, включая должность и компанию.
`Company` - компания.

Работник и его текущее место работы относятся друг к другу как один к одному, в нашей системе один человек не может работать на нескольких работах одновременно.
Также место работы и компания связаны отношением один к одному.

Но у работника может быть список предыдущих мест работы и такое отношение называется один ко многим.
Также как у компании в данный момент есть штат из работников (Company -> employees) и это тоже отношение один ко многим.

## Объявление мутаций

Для объявления мутаций используйте специальный тип `Mutation`. Называть мутации надо так:
- Для создания название должно начинаться с `create`, `persist`, `add`; идентификатор передавать не надо, он будет сгенерирован автоматически.
- Для обновления название должно начинаться с `update`, `upgrade`, `mark` и первым аргументом мутации должен быть `ID` ресурса для обновления, а после него поля для обновления.
- Для удаления название должно начинаться с `delete`, `remove` и единственным аргументом мутации должен быть `ID` ресурса для удаления.
:::note
В данный момент `updateBy` и `deleteBy` (для обновения и удаления не по `ID`, а по любому другому полю) не поддерживаются, но будут поддержаны в скором времени.
:::

## Объявление запросов

Для объявления запроса используйте специальный тип `Query`.
Для запроса всех ресурсов определённого типа, просто объявите мутацию, которая будет возвращать список этого типа.
```graphql
type Query {
    getAll: [Company!]
}
```
Для запроса ресурса определённого типа по `ID`, надо объявить мутацию, аргументом которой будет `ID`, а возвращаемым типом будет нужный тип.
```graphql
type Query {
    getById(id: ID!): Company
}
```
